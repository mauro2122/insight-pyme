{% extends "base.html" %}
{% block title %}Insight PYME - Tablero{% endblock %}

{% block content %}
<div class="row g-3">

  <!-- Filtros de fecha -->
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="row g-2 align-items-end">
          <div class="col-auto">
            <label class="form-label">Desde</label>
            <input type="date" class="form-control" id="f-desde">
          </div>
          <div class="col-auto">
            <label class="form-label">Hasta</label>
            <input type="date" class="form-control" id="f-hasta">
          </div>
          <div class="col-auto d-grid">
            <button class="btn btn-outline-primary" id="btn-aplicar">Aplicar</button>
          </div>
          <div class="col-auto d-grid">
            <button class="btn btn-outline-secondary" id="btn-limpiar">Limpiar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KPIs -->
  <div class="col-12">
    <div class="row g-3">
      <div class="col-md-3">
        <div class="card shadow-sm"><div class="card-body">
          <div class="text-secondary small">Ventas del mes</div>
          <div class="fs-4 fw-bold" id="kpi-ventas-mes">—</div>
        </div></div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm"><div class="card-body">
          <div class="text-secondary small">Crecimiento</div>
          <div class="fs-4 fw-bold" id="kpi-crecimiento">—</div>
        </div></div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm"><div class="card-body">
          <div class="text-secondary small">Ticket promedio</div>
          <div class="fs-4 fw-bold" id="kpi-ticket">—</div>
        </div></div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm"><div class="card-body">
          <div class="text-secondary small">Clientes únicos</div>
          <div class="fs-4 fw-bold" id="kpi-clientes">—</div>
        </div></div>
      </div>
    </div>
  </div>

  <!-- Top productos -->
  <div class="col-lg-7">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Top productos</h5>
        <div class="table-responsive">
          <table class="table align-middle">
            <thead><tr>
              <th>Producto</th>
              <th class="text-end">Ingresos</th>
            </tr></thead>
            <tbody id="top-body">
              <tr><td colspan="2" class="text-center text-secondary">Cargando…</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Predicción -->
  <div class="col-lg-5">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Predicción de demanda</h5>
        <form id="form-predict" class="row gy-2 gx-2 align-items-center">
          <div class="col-12">
            <label class="form-label">Producto</label>
            <select id="sel-producto" class="form-select">
              {% for p in productos %}
                <option value="{{ p.id }}">{{ p.nombre }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-6">
            <label class="form-label">Días a futuro</label>
            <input id="inp-dias" type="number" min="7" max="120" step="1" value="30" class="form-control">
          </div>
          <div class="col-6 d-grid">
            <label class="form-label d-none d-md-block">&nbsp;</label>
            <button class="btn btn-primary" type="submit" id="btn-predict">
              <span class="spinner-border spinner-border-sm d-none" id="spin" role="status"></span>
              <span>Predecir</span>
            </button>
          </div>
        </form>
        <hr>
        <div id="pred-resultado" class="mt-2 text-secondary">—</div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Ventas por hora</h5>
        <canvas id="chart-hora" height="120"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Ventas por día</h5>
        <canvas id="chart-dia" height="120"></canvas>
      </div>
    </div>
  </div>
</div>
{% endblock %}
